{
  "version": 3,
  "sources": ["../src/note.ts", "../src/monzo.ts", "../src/matrix.ts", "../src/renderer.ts", "../src/main.ts"],
  "sourcesContent": ["import type p5_ from \"p5\";\r\nimport { getFrequency, Monzo, Val } from \"./monzo\";\r\nimport { Vector, Matrix, applyMatrix } from \"./matrix\";\r\n\r\nexport interface Note {\r\n    name: string,\r\n    oct: number,\r\n    monzo: Monzo,\r\n}\r\n\r\nfunction addOctave(Note: Note, n: number): Note {\r\n    return {\r\n        name: Note.name,\r\n        oct: Note.oct + n,\r\n        monzo: {\r\n            m: Note.monzo.m + n,\r\n            n: Note.monzo.n,\r\n        },\r\n    }\r\n}\r\n\r\nfunction addFlat(Note: Note, n: number): Note {\r\n    if (Note.name.endsWith(\"\u266F\")) {\r\n        throw new Error(\"Cannot add flat to a sharp note\");\r\n    }\r\n    return {\r\n        name: Note.name + \"\u266D\".repeat(n),\r\n        oct: Note.oct,\r\n        monzo: {\r\n            m: Note.monzo.m + n * 11,\r\n            n: Note.monzo.n - n * 7,\r\n        },\r\n    }\r\n}\r\nfunction addSharp(Note: Note, n: number): Note {\r\n    if (Note.name.endsWith(\"\u266D\")) {\r\n        throw new Error(\"Cannot add sharp to a flat note\");\r\n    }\r\n    return {\r\n        name: Note.name + \"\u266F\".repeat(n),\r\n        oct: Note.oct,\r\n        monzo: {\r\n            m: Note.monzo.m - n * 11,\r\n            n: Note.monzo.n + n * 7,\r\n        },\r\n    }\r\n}\r\n\r\nexport function generateNotes(minOct = 2, maxOct = 6, baseOct = 4, flatNum = 1, sharpNum = 1): Note[] {\r\n    const names = [\"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\"];\r\n\r\n    // 12,19\u3067step\u3092\u691C\u7B97\r\n    const diatonic: Note[] = [\r\n        { name: \"C\", oct: baseOct, monzo: { m: 0, n: 0 } }, // 0\r\n        { name: \"D\", oct: baseOct, monzo: { m: -3, n: 2 } }, // -36 + 38 = 2\r\n        { name: \"E\", oct: baseOct, monzo: { m: -6, n: 4 } }, // -72 + 76 = 4\r\n        { name: \"F\", oct: baseOct, monzo: { m: 2, n: -1 } }, // 24 - 19 = 5\r\n        { name: \"G\", oct: baseOct, monzo: { m: -1, n: 1 } }, // -12 + 19 = 7\r\n        { name: \"A\", oct: baseOct, monzo: { m: -4, n: 3 } }, // -48 + 57 = 9\r\n        { name: \"B\", oct: baseOct, monzo: { m: -7, n: 5 } }, // -84 + 95 = 11\r\n    ];\r\n\r\n    const chromatic: Note[] = [...diatonic];\r\n    for (let i = 1; i <= flatNum; i++) {\r\n        for (const note of diatonic) {\r\n            chromatic.push(addFlat(note, i));\r\n        }\r\n    }\r\n    for (let i = 1; i <= sharpNum; i++) {\r\n        for (const note of diatonic) {\r\n            chromatic.push(addSharp(note, i));\r\n        }\r\n    }\r\n\r\n    const notes: Note[] = [];\r\n    for (let oct = minOct; oct <= maxOct; oct++) {\r\n        for (const note of chromatic) {\r\n            const octDiff = oct - baseOct;\r\n            notes.push(addOctave(note, octDiff));\r\n        }\r\n    }\r\n\r\n    return notes.sort((a, b) => {\r\n        const aVal = Math.pow(2, a.monzo.m) * Math.pow(3, a.monzo.n);\r\n        const bVal = Math.pow(2, b.monzo.m) * Math.pow(3, b.monzo.n);\r\n        return aVal - bVal;\r\n    });\r\n}", "export interface Monzo {\r\n    m: number,\r\n    n: number,\r\n}\r\n\r\n// S = P^(1/p) = Q^(1/q) \u3068\u3057\u305F\u3044\r\nexport interface Val {\r\n    P: number,\r\n    Q: number,\r\n    baseFreq: number,\r\n\r\n    S: number | null,\r\n    p: number | null,\r\n    q: number | null,\r\n}\r\n\r\nexport function getFrequency(monzo: Monzo, val: Val): number {\r\n    return val.baseFreq * Math.pow(val.P, monzo.m) * Math.pow(val.Q, monzo.n);\r\n}\r\n\r\nexport function getSteps(val: Val, monzo: Monzo): number | null {\r\n    if (val.p === null || val.q === null) return null;\r\n\r\n    return monzo.m * val.p + monzo.n * val.q;\r\n}\r\n\r\nexport function makeVal_fromP(p: number, q: number, P: number, baseFreq: number): Val {\r\n    const S = Math.pow(P, 1 / p);\r\n    const Q = Math.pow(S, q);\r\n\r\n    return { P, Q, S, p, q, baseFreq };\r\n}\r\n\r\nexport function makeVal_fromQ(p: number, q: number, Q: number, baseFreq: number): Val {\r\n    const S = Math.pow(Q, 1 / q);\r\n    const P = Math.pow(S, p);\r\n\r\n    return { P, Q, S, p, q, baseFreq };\r\n}\r\n\r\nexport function makeVal_fromS(p: number, q: number, S: number, baseFreq: number): Val {\r\n    const P = Math.pow(S, p);\r\n    const Q = Math.pow(S, q);\r\n\r\n    return { P, Q, S, p, q, baseFreq };\r\n}\r\n\r\nexport function makeVal_asIrrational(P: number, Q: number, baseFreq: number): Val {\r\n    return { P, Q, S: null, p: null, q: null, baseFreq };\r\n}", "export interface Matrix {\r\n    a: number,\r\n    b: number,\r\n    c: number,\r\n    d: number,\r\n}\r\n\r\nexport interface Vector {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\nexport function applyMatrix(matrix: Matrix, vector: Vector): Vector {\r\n    return {\r\n        x: matrix.a * vector.x + matrix.c * vector.y,\r\n        y: matrix.b * vector.x + matrix.d * vector.y,\r\n    }\r\n}", "import type p5_ from \"p5\";\r\nimport { getFrequency, Monzo, Val } from \"./monzo\";\r\nimport { Vector, Matrix, applyMatrix } from \"./matrix\";\r\nimport { Note } from \"./note\";\r\n\r\nexport const radius = 30; //px\r\n\r\nexport function noteToPos(note: Note, matrix: Matrix): Vector {\r\n    const vector: Vector = {\r\n        x: note.monzo.m,\r\n        y: note.monzo.n,\r\n    };\r\n\r\n    return applyMatrix(matrix, vector);\r\n}\r\n\r\nfunction fmod(a: number, b: number): number {\r\n    return a - b * Math.floor(a / b);\r\n}\r\n\r\nfunction noteToHue(note: Note): number {\r\n    return fmod((note.monzo.n * Math.log(3) / Math.log(2)) * 360, 360);\r\n}\r\n\r\nexport function drawNote(p5: p5_, note: Note, matrix: Matrix, val: Val) {\r\n    p5.push();\r\n    const hue = noteToHue(note);\r\n    const pos = noteToPos(note, matrix);\r\n    p5.colorMode(p5.HSB);\r\n    p5.fill(hue, 100, 50);\r\n    p5.stroke(hue, 100, 100)   \r\n    p5.circle(pos.x, pos.y, radius * 2);\r\n\r\n    p5.textAlign(p5.CENTER, p5.CENTER);\r\n    p5.textSize(30);\r\n    p5.fill(255);\r\n    p5.noStroke()\r\n    p5.textSize(30);\r\n    p5.text(`${note.name}${note.oct}`, pos.x, pos.y - 15);\r\n    p5.textSize(15);\r\n    p5.text(`\\n\uFF3B${note.monzo.m} ${note.monzo.n}\u3009 \\n ${getFrequency(note.monzo, val).toFixed(1)}Hz`, pos.x, pos.y + 10);\r\n    p5.pop();\r\n}", "import type p5_ from \"p5\"; // \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u306E\u578B\u540D\u306Fp5\u3060\u3068\u2193\u3068\u88AB\u308B\u306E\u3067\u30BA\u30E9\u3059\r\ndeclare const p5: typeof p5_; // \u5916\u90E8\u3067\u5024\u3068\u3057\u3066\u306Ep5\u304C\u5B9F\u88C5\u3055\u308C\u3066\u3044\u308B\u3053\u3068\u3092\u5BA3\u8A00\r\n\r\nimport { generateNotes, Note } from \"./note\";\r\nimport { getSteps, makeVal_fromP } from \"./monzo\";\r\nimport { drawNote } from \"./renderer\";\r\n\r\nconst notes = generateNotes(2, 6, 4, 2, 2);\r\nconst val = makeVal_fromP(17, 27, 2, 440);\r\n\r\nfor (const note of notes) {\r\n    const steps = getSteps(val, note.monzo);\r\n    console.log(note, steps);\r\n}\r\n\r\n// p5\u306E\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u30E2\u30FC\u30C9\u3067\u66F8\u304F\r\nconst sketch = (p: p5_) => {\r\n    p.setup = () => {\r\n        p.createCanvas(p.windowWidth, p.windowHeight);\r\n    };\r\n    p.windowResized = () => {\r\n        p.resizeCanvas(p.windowWidth, p.windowHeight);\r\n    }\r\n    p.draw = () => {\r\n        p.background(30);\r\n        p.translate(p.width / 2, p.height / 2);\r\n        const scale = 80;\r\n        notes.forEach(note => {\r\n            drawNote(p, note, {a: 1 * scale, b: -2 * scale, c: 1 * scale, d: -3 * scale}, val);\r\n        });\r\n    };\r\n};\r\n\r\nnew p5(sketch);"],
  "mappings": "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",
  "names": ["Note", "notes", "val", "p5", "val"]
}
